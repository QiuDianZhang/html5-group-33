1. 需求分析 (Requirement Analysis)
1.1 用户痛点
记忆模糊：买了什么书、读到哪一页了，时间久了容易忘记。
缺乏反馈：阅读过程枯燥，缺乏可视化的进度反馈和成就感。
数据不安全：担心使用在线APP会泄露隐私，或因服务商倒闭导致数据丢失。
专注力差：阅读时容易被手机其他消息打断。
1.2 功能需求 (Functional Requirements)
1.2.1 书籍管理 (Core CRUD)
添加书籍：支持输入书名、作者、分类、总页数、封面图（本地上传）等信息。
约束：书名必填，支持默认值（如作者默认为“佚名”），输入长度限制。
书籍列表：支持按“想读/在读/已读”状态筛选，支持关键词（书名/作者）搜索。
书籍详情：展示书籍详细信息、阅读进度条、评分及读书笔记。
编辑/删除：可随时更新阅读进度或删除书籍。
1.2.2 专注阅读 (Focus Timer)
正向计时：提供开始/停止计时功能。
防熄屏：计时过程中保持屏幕常亮。
后台计时：支持切换至后台或退出小程序后，计时逻辑不中断（基于时间戳差值算法）。
时长统计：计时结束后，自动将阅读时长累计至当日数据中。
1.2.3 数据可视化 (Data Visualization)
阅读进度条：在详情页通过可视化进度条展示阅读完成度（百分比 + 页码）。
读书日历 (Heatmap)：仿 GitHub 贡献图，以月视图展示每日阅读时长。颜色越深代表阅读时间越长，点击具体日期可查看当日阅读时长。
1.2.4 数据安全 (Data Security)
本地存储：所有数据均存储在微信小程序的 Storage 中，不经过云端，保护隐私。
数据备份/恢复：支持将所有数据导出为 JSON 字符串（剪贴板），并支持从剪贴板导入数据以覆盖恢复。
1.3 非功能需求 (Non-functional Requirements)
易用性：界面简洁无广告，操作符合微信原生体验。
鲁棒性：处理异常输入（如负数页码），处理图片加载失败等情况。
性能：页面切换流畅，本地存储读写无明显延迟。
2. 系统设计 (System Design)
2.1 技术架构
本项目采用 微信小程序原生开发框架 (MINA)。

视图层 (View): WXML (结构) + WXSS (样式)。
逻辑层 (App Service): JavaScript，负责数据处理和事件响应。
数据层 (Data): wx.setStorageSync / wx.getStorageSync (本地键值对存储)。
2.2 数据结构设计 (Data Structure)
系统主要依赖两个核心 Storage Key 进行存储：

2.2.1 书籍列表 (myBooks)
存储为对象数组 Array<Book>，结构如下：

JavaScript
[
  {
    "id": 1698300001,          // 时间戳作为唯一ID
    "title": "三体",           // 书名
    "author": "刘慈欣",        // 作者
    "category": "科幻",        // 分类
    "cover": "wxfile://...",   // 封面图片本地路径
    "status": "reading",       // 状态: want/reading/read
    "rating": 5,               // 评分: 0-5
    "notes": "读后感...",      // 笔记
    "currentPage": 100,        // 当前页码
    "totalPages": 300,         // 总页码
    "updateTime": "2025/..."   // 最后更新时间
  }
]
2.2.2 阅读时长记录 (reading_duration)
存储为键值对对象 Object，Key 为日期，Value 为分钟数：

JavaScript
{
  "2025-12-20": 45,   // 20号读了45分钟
  "2025-12-21": 90,   // 21号读了90分钟
  "2025-12-22": 15    // ...
}
2.3 关键算法逻辑
2.3.1 后台计时算法
为解决小程序切后台导致 setInterval 暂停的问题，采用 时间戳差值法：

Start：记录 timer_start_time = Date.now() 存入 Storage。
Display：UI 定时刷新，显示 CurrentTime - timer_start_time。
Background：切后台时，Storage 中的开始时间不变。
Resume：切回前台时，重新计算差值，UI 自动跳变到正确时间。
2.3.2 读书日历生成算法
计算当月有多少天（daysInMonth）及当月1号是周几（firstDayOfWeek）。
生成 firstDayOfWeek 个空白格子占位。
循环 1 到 daysInMonth，构建日期 Key（如 2025-12-01）。
用 Key 去 reading_duration 中查询时长。
根据时长设定 CSS 等级类名（level-1, level-2, level-3）渲染颜色。
3. 界面设计 (UI Design)
3.1 页面规划
项目包含四个核心页面：

首页 (Home)

顶部：吸顶式“专注阅读计时器”。
中部：搜索栏 + 设置入口（导入导出）。
导航：日历入口卡片。
主体：Tab 分类（全部/想读/在读/已读） + 书籍列表（带封面、进度条）。
底部：悬浮“+”号添加按钮。
添加/编辑页 (Add/Edit)

表单式设计，包含封面上传、书名、作者、分类、页数录入。
交互亮点：五星评分组件（点击星星打分）。
详情页 (Detail)

展示书籍大图封面、详细元数据。
进度展示：百分比进度条 + “已读/总页数”文字。
读书笔记展示区域。
读书日历页 (Calendar)

月视图日历，支持月份切换。
基于 GitHub 风格的绿色热力图展示。
底部展示本月累计专注时长。
